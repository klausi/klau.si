<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>
      
  Klausi&#x27;s Weblog - Proposing a Drupal 7 security team

    </title>

    
      <link rel="alternate"
            type="application/rss+xml"
            title="RSS"
            href="https://klau.si/rss.xml">
    

    
      
    

    
      <link rel="stylesheet"
            href="https://klau.si/site.css">
      
    

    
  
  <meta property="og:title" content="Proposing a Drupal 7 security team">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://klau.si/blog/proposing-drupal-7-security-team/">
  
    <meta property="og:description" content="Update: The D7Security group is now established at gitlab.com&#x2F;d7security and d7security.org!

The Drupal Security Team has announced in PSA-2023-06-07 that unsuâ€¦">
  
  <meta property="og:site_name" content="Klausi&#x27;s Weblog">
  
    <meta property="article:published_time" content="2023-12-12">
  

  
  

  
  

  
  
    
    
    
      
      
        
        
          
        
      
    
  

  
  

  <meta property="og:image" content="https://klau.si/blog/proposing-drupal-7-security-team/unsupported-hm.webp">

  </head>

  <body>
    <div class="container">

      <input type="checkbox"
             id="mobile-menu-toggle"
             class="mobile-menu-toggle"
             aria-label="Toggle mobile menu">

      <div id="mobile-navbar" class="mobile-navbar">
        <div class="mobile-header-logo">
          <a href="https:&#x2F;&#x2F;klau.si"
             title="Klausi&#x27;s Weblog"
             rel="home"
             class="site-logo site-title">
            <img src="https://klau.si/logo.webp"
                 alt="Klausi&#x27;s Weblog logo">
          </a>
          <a href="/" class="logo">Klausi&#x27;s Weblog</a>
        </div>
        <label for="mobile-menu-toggle"
               class="mobile-navbar-icon"
               role="button"
               aria-controls="mobile-menu"
               aria-label="Toggle menu">
          <span aria-hidden="true">&nbsp;</span>
          <span aria-hidden="true">&nbsp;</span>
          <span aria-hidden="true">&nbsp;</span>
        </label>
      </div>

      <header id="header">
        <div class="logo">
          <a href="https:&#x2F;&#x2F;klau.si"
             title="Klausi&#x27;s Weblog"
             rel="home"
             class="site-logo site-title">
            <img src="https://klau.si/logo.webp"
                 alt="Klausi&#x27;s Weblog logo">
          </a>
          <a href="https:&#x2F;&#x2F;klau.si">Klausi&#x27;s Weblog</a>
        </div>
        <nav class="menu">
          <ul>
            
              <li>
                <a href="https:&#x2F;&#x2F;klau.si">
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;tags&#x2F;speaking">
                  Speaking
                  
                </a>
              </li>
            
              <li>
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;tags">
                  Categories
                  
                </a>
              </li>
            
              <li>
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;rss.xml">
                  RSS
                  

                    <img src="https://klau.si/icons/rss-icon.svg"
                         alt="RSS icon"
                         style="vertical-align: middle;
                                width: 16px;
                                height: 16px;
                                position: relative;
                                top: -2px">
                  
                </a>
              </li>
            
          </ul>
        </nav>
      </header>

      <main>
        <div class="content" id="mobile-panel">
          

  
    <div class="post-toc" id="post-toc">
      <h2 class="post-toc-title">Contents</h2>
      <div class="post-toc-content always-active">
        <nav id="TableOfContents">
          <ul>
            
              <li>
                <a href="https://klau.si/blog/proposing-drupal-7-security-team/#background" class="toc-link">Background</a>
                
              </li>
            
              <li>
                <a href="https://klau.si/blog/proposing-drupal-7-security-team/#proactive-maintenance-approach" class="toc-link">Proactive Maintenance Approach</a>
                
              </li>
            
              <li>
                <a href="https://klau.si/blog/proposing-drupal-7-security-team/#blocked-on-unsupported-projects" class="toc-link">Blocked on unsupported projects</a>
                
              </li>
            
              <li>
                <a href="https://klau.si/blog/proposing-drupal-7-security-team/#establishing-an-unofficial-d7security-team-on-gitlab-com" class="toc-link">Establishing an unofficial D7Security team on Gitlab.com</a>
                
              </li>
            
              <li>
                <a href="https://klau.si/blog/proposing-drupal-7-security-team/#pushing-update-notifications-from-gitlab-com-to-drupal-7-sites" class="toc-link">Pushing update notifications from Gitlab.com to Drupal 7 sites</a>
                
              </li>
            
              <li>
                <a href="https://klau.si/blog/proposing-drupal-7-security-team/#why-gitlab-com" class="toc-link">Why Gitlab.com?</a>
                
              </li>
            
              <li>
                <a href="https://klau.si/blog/proposing-drupal-7-security-team/#conclusion" class="toc-link">Conclusion</a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  

  <article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            
                Proposing a Drupal 7 security team
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2023-12-12</span>
            
        </div>
    </header>

    <div class="post-content"><p><strong>Update:</strong> The D7Security group is now established at <a rel="external" href="https://gitlab.com/d7security">gitlab.com/d7security</a> and <a rel="external" href="https://www.d7security.org/">d7security.org</a>!</p>
<p><img src="https://klau.si/blog/proposing-drupal-7-security-team/unsupported-hm.webp" alt="Screenshot of a drupal.org release settings page. Contains a warning box with the text &quot;Branches compatible with Drupal 7.x that are set as unsupported cannot be set as supported again.&quot;. A big thinking emoji is inserted on the screenshot." /></p>
<p>The Drupal Security Team has announced in <a rel="external" href="https://www.drupal.org/psa-2023-06-07">PSA-2023-06-07</a> that unsupported Drupal 7 modules/themes cannot be supported again. I'm proposing to create a D7Security team on Gitlab.com that can provide security fixes for those unsupported modules. A small update module can then notify Drupal 7 site owners when new security releases are available on Gitlab.com.</p>
<span id="continue-reading"></span><h2 id="background">Background</h2>
<p>A significant number of Drupal 7 sites are still operational. Some of these are scheduled for an upgrade to the more recent Drupal 10 platform, yet it is expected that a considerable number will continue to use Drupal 7 beyond its official support end date on January 5, 2025.</p>
<p>Those sites often include hundreds of Drupal 7 contributed projects from drupal.org. While some modules are maintained by the site owners in collaboration with the Drupal community, for many others, there's reliance on other maintainers for critical updates such as security and PHP compatibility.</p>
<h2 id="proactive-maintenance-approach">Proactive Maintenance Approach</h2>
<p>When a module in use cannot be supported by the original maintainers, the strategy is to assume the role of maintainers to extend security support. This is a practical decision: maintaining the code internally is essential for site security, so sharing these updates with the community as official releases is beneficial. This shared responsibility model is very common in the Drupal community.</p>
<h2 id="blocked-on-unsupported-projects">Blocked on unsupported projects</h2>
<p>While taking on the role of maintainers has been effective previously, there are now obstacles in continuing this on drupal.org. The Drupal Security Team is inclined to discontinue support for Drupal 7 projects. As a result, once a Drupal 7 project loses support, the policy is now to not mark it as supported again.</p>
<p>I have a lot of empathy for the Drupal Security Team: many of the members don't run Drupal 7 sites anymore and it can be a hassle to track down Drupal 7 module maintainers when preparing security releases. That's why they want to phase out Drupal 7 support where possible. However, there's potential to reallocate the tasks related to Drupal 7 security to a group specifically interested in maintaining these older versions.</p>
<h2 id="establishing-an-unofficial-d7security-team-on-gitlab-com">Establishing an unofficial D7Security team on Gitlab.com</h2>
<p>In order to unburden the Drupal Security Team and the Drupal Infrastructure team I think it would be best to establish an unofficial Drupal 7 security team (let's call it D7Security team) on Gitlab.com. I will describe later how we can communicate security releases from Gitlab.com through the standard Drupal 7 update notification system.</p>
<p>The D7Security organization on Gitlab.com would be completely independent of the Drupal Security Team with these benefits:</p>
<ol>
<li>Drupal 7 modules can get unsupported on drupal.org, but releases (including security updates) can be made on Gitlab.com. Maintainers and the security team don't have to feel guilty: D7Security will pick it up if it is used by a member company.</li>
<li>The Drupal Security team can publish any non mass-exploitable Drupal 7 vulnerability, as <a rel="external" href="https://www.drupal.org/psa-2023-06-07">is already policy</a>. Then the D7Security team can pick it up.</li>
<li>For mass-exploitable remote code execution vulnerabilities the Drupal Security Team can reach out to the D7Security team with a warning even beyond January 5, 2025.</li>
</ol>
<h2 id="pushing-update-notifications-from-gitlab-com-to-drupal-7-sites">Pushing update notifications from Gitlab.com to Drupal 7 sites</h2>
<p>The update notification system of Drupal 7 works with XML feeds that are downloaded from drupal.org (<a rel="external" href="https://updates.drupal.org/release-history/devel/7.x">example for devel module</a>). Luckily this update system is pluggable and we can apply some nice tricks to download update information XML from static Gitlab.com files instead.</p>
<p>The rough workflow would go like this:</p>
<ol>
<li>The unsupported module code is forked to a Gitlab.com repository.</li>
<li>A fix is committed, a new git tag and a release is created on Gitlab.com.</li>
<li>The update XML is crafted by hand (later automated) in a central Gitlab.com repository pointing to the Gitlab.com release (<a rel="external" href="https://gitlab.com/d7security/d7security/-/blob/main/devel/7.x">example for devel</a>). The path <code>devel/7.x</code> is important as that will be appended by update module when fetching the XML.</li>
<li>The module is added to the list of supported modules on Gitlab.com (<a rel="external" href="https://gitlab.com/d7security/d7security/-/blob/main/supported_projects.txt">supported_projects.txt</a>)</li>
<li>The Drupal 7 site operator installs a small helper module that fetches update information from Gitlab.com on top of the default drupal.org source. The <a rel="external" href="https://gitlab.com/d7security/d7security_client">d7security_client</a> module for that is just a few lines of code:</li>
</ol>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="php"><span class="giallo-l"><span style="color: #6A737D;">/**</span></span>
<span class="giallo-l"><span style="color: #6A737D;"> * Implements hook_system_info_alter().</span></span>
<span class="giallo-l"><span style="color: #6A737D;"> *</span></span>
<span class="giallo-l"><span style="color: #6A737D;"> * This hook will swap out the update XML URL for projects now supported at</span></span>
<span class="giallo-l"><span style="color: #6A737D;"> * D7Security.</span></span>
<span class="giallo-l"><span style="color: #6A737D;"> *</span></span>
<span class="giallo-l"><span style="color: #6A737D;"> */</span></span>
<span class="giallo-l"><span style="color: #F97583;">function</span><span style="color: #B392F0;"> d7security_client_system_info_alter</span><span>(</span><span style="color: #F97583;">array &amp;</span><span>$info,</span><span style="color: #79B8FF;"> \stdClass</span><span> $file,</span><span style="color: #F97583;"> string</span><span> $type) {</span></span>
<span class="giallo-l"><span style="color: #6A737D;">  // Statically cache the list of supported projects to make only 1 HTTP</span></span>
<span class="giallo-l"><span style="color: #6A737D;">  // request.</span></span>
<span class="giallo-l"><span>  $supported_projects</span><span style="color: #F97583;"> = &amp;</span><span style="color: #B392F0;">drupal_static</span><span>(</span><span style="color: #79B8FF;">__FUNCTION__</span><span>,</span><span style="color: #79B8FF;"> NULL</span><span>);</span></span>
<span class="giallo-l"><span style="color: #F97583;">  if</span><span> (</span><span style="color: #79B8FF;">is_null</span><span>($supported_projects)) {</span></span>
<span class="giallo-l"><span>    $supported_projects</span><span style="color: #F97583;"> =</span><span> [];</span></span>
<span class="giallo-l"><span>    $supported_projects_url</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> variable_get</span><span>(</span><span style="color: #9ECBFF;">&#39;d7security_client_supported_projects_url&#39;</span><span>,</span><span style="color: #9ECBFF;"> &#39;https://gitlab.com/d7security/d7security/-/raw/main/supported_projects.txt&#39;</span><span>);</span></span>
<span class="giallo-l"><span>    $d7sec_supported</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> drupal_http_request</span><span>($supported_projects_url);</span></span>
<span class="giallo-l"><span style="color: #F97583;">    if</span><span> ($d7sec_supported</span><span style="color: #F97583;">-&gt;</span><span>code</span><span style="color: #F97583;"> ==</span><span style="color: #79B8FF;"> 200</span><span>) {</span></span>
<span class="giallo-l"><span>      $supported_projects</span><span style="color: #F97583;"> =</span><span style="color: #79B8FF;"> array_filter</span><span>(</span><span style="color: #79B8FF;">array_map</span><span>(</span><span style="color: #9ECBFF;">&#39;trim&#39;</span><span>,</span><span style="color: #79B8FF;"> explode</span><span>(</span><span style="color: #9ECBFF;">&quot;</span><span style="color: #79B8FF;">\n</span><span style="color: #9ECBFF;">&quot;</span><span>, $d7sec_supported</span><span style="color: #F97583;">-&gt;</span><span>data)));</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span style="color: #F97583;">    else</span><span> {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">      watchdog</span><span>(</span><span style="color: #9ECBFF;">&#39;d7security_client&#39;</span><span>,</span><span style="color: #9ECBFF;"> &#39;Could not fetch supported projects list from Gitlab: &lt;pre&gt;@error&lt;/pre&gt;&#39;</span><span>, [</span></span>
<span class="giallo-l"><span style="color: #9ECBFF;">        &#39;@error&#39;</span><span style="color: #F97583;"> =&gt;</span><span style="color: #79B8FF;"> print_r</span><span>($d7sec_supported,</span><span style="color: #79B8FF;"> TRUE</span><span>),</span></span>
<span class="giallo-l"><span>      ],</span><span style="color: #79B8FF;"> WATCHDOG_ERROR</span><span>);</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>  }</span></span>
<span class="giallo-l"><span style="color: #F97583;">  if</span><span> (</span><span style="color: #F97583;">!</span><span style="color: #79B8FF;">empty</span><span>($info[</span><span style="color: #9ECBFF;">&#39;project&#39;</span><span>])</span><span style="color: #F97583;"> &amp;&amp;</span><span style="color: #79B8FF;"> in_array</span><span>($info[</span><span style="color: #9ECBFF;">&#39;project&#39;</span><span>], $supported_projects)) {</span></span>
<span class="giallo-l"><span>    $info[</span><span style="color: #9ECBFF;">&#39;project status url&#39;</span><span>]</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> variable_get</span><span>(</span><span style="color: #9ECBFF;">&#39;d7security_client_project_status_base_url&#39;</span><span>,</span><span style="color: #9ECBFF;"> &#39;https://gitlab.com/d7security/d7security/-/raw/main&#39;</span><span>);</span></span>
<span class="giallo-l"><span>  }</span></span>
<span class="giallo-l"><span style="color: #6A737D;">  // ...</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>This will now show any new releases in the Drupal 7 backend as usual and trigger update notification emails.</p>
<p>The great benefit of this static file approach is that there are no update server operation costs.</p>
<p>One important thing missing here is the drupal.org packaging script which adds version information into the module's info file. I'm sure there are some other details as well that I have missed, but the approach should work in general.</p>
<h2 id="why-gitlab-com">Why Gitlab.com?</h2>
<p>It should be possible to do a similar approach on drupal.org's Gitlab, but I think it could get very confusing where the actual replacement code for a module lives. I prefer Gitlab.com for organization governance reasons, then it is easy to define repository access based on groups.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This is currently a proposal that I would like to get feedback on. Feel free to reach out and discuss in <a rel="external" href="https://www.drupal.org/project/ideas/issues/3408125">the Drupal ideas issue</a>.</p>
</div>

    
    

    <div class="post-footer">
      
        
          <div class="post-tags">
            
              <a href="https://klau.si/tags/d7security/">#d7security</a>
            
              <a href="https://klau.si/tags/drupal/">#drupal</a>
            
              <a href="https://klau.si/tags/drupal-planet/">#drupal planet</a>
            
          </div>
        

      

    </div>

    
    
  </article>


        </div>
      </main>

      
        <footer>
          <ul class="footer-social">
            <li>
              <a href="https://mastodon.social/@klausi" title="Mastodon" rel="me">
                <img src="https://klau.si/icons/mastodon.svg"
                     alt="Mastodon icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>Human social media</span>
              </a>
            </li>
            <li>
              <a href="https://www.drupal.org/u/klausi" title="Drupal" rel="me">
                <img src="https://klau.si/icons/drupal.svg"
                     alt="Drupal icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>Drupal profile</span>
              </a>
            </li>
            <li>
              <a href="https://github.com/klausi" title="GitHub" rel="me">
                <picture>
                  <source media="(prefers-color-scheme: dark)"
                          srcset="https://klau.si/icons/github-darkmode.svg">
                  <img src="https://klau.si/icons/github.svg"
                       alt="GitHub icon"
                       class="social-icon"
                       width="24"
                       height="24">
                </picture>
                <span>Stalk my code</span>
              </a>
            </li>
            <li>
              <a href="https://bsky.app/profile/klau.si" title="Bluesky" rel="me">
                <img src="https://klau.si/icons/bluesky.svg"
                     alt="Bluesky icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>Fake Twitter funded by crypto bros</span>
              </a>
            </li>
            <li>
              <a href="https://www.linkedin.com/in/klausi" title="LinkedIn" rel="me">
                <img src="https://klau.si/icons/linkedin.svg"
                     alt="LinkedIn icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>The business hellsite</span>
              </a>
            </li>
            <li>
              <a href="https://klau.si/rss.xml"
                 title="RSS Feed">
                <img src="https://klau.si/icons/rss-icon.svg"
                     alt="RSS icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>RSS</span>
              </a>
            </li>
          </ul>
          <p class="footer-license">
            <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
              <img alt="Creative Commons License"
                   style="border-width:0"
                   src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
            </a>
            <br />
            This work by
            <span xmlns:cc="http://creativecommons.org/ns#"
                  property="cc:attributionName">Klaus Purer</span> is licensed
            under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons
            Attribution-ShareAlike 4.0 International License</a>.
          </p>
        </footer>
      

      <nav id="mobile-menu" class="mobile-menu">
        <ul class="mobile-menu-list">
          
            <li class="mobile-menu-item">
              <a href="https:&#x2F;&#x2F;klau.si">
                Home
                
              </a>
            </li>
          
            <li class="mobile-menu-item">
              <a href="https:&#x2F;&#x2F;klau.si&#x2F;tags&#x2F;speaking">
                Speaking
                
              </a>
            </li>
          
            <li class="mobile-menu-item">
              <a href="https:&#x2F;&#x2F;klau.si&#x2F;tags">
                Categories
                
              </a>
            </li>
          
            <li class="mobile-menu-item">
              <a href="https:&#x2F;&#x2F;klau.si&#x2F;rss.xml">
                RSS
                

                  <img src="https://klau.si/icons/rss-icon.svg"
                       alt="RSS icon"
                       style="vertical-align: middle;
                              width: 16px;
                              height: 16px;
                              position: relative;
                              top: -2px">
                
              </a>
            </li>
          
        </ul>
      </nav>

      <label for="mobile-menu-toggle"
             class="mobile-menu-overlay"
             aria-hidden="true">&nbsp;</label>
    </div>

    
      <script type="text/javascript"
              src="https://klau.si/even.js"></script>
    
  </body>

</html>
