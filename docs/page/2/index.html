<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>
      
        Klausi&#x27;s Weblog
      
    </title>

    
      <link rel="alternate"
            type="application/rss+xml"
            title="RSS"
            href="https://klau.si/rss.xml">
    

    
      
    

    
      <link rel="stylesheet"
            href="https://klau.si/site.css">
      
    

    
      
      <meta property="og:title" content="Klausi&#x27;s Weblog">
      <meta property="og:type" content="website">
      <meta property="og:url" content="https:&#x2F;&#x2F;klau.si">
      <meta property="og:site_name" content="Klausi&#x27;s Weblog">
      <meta property="og:image" content="https://klau.si/opengraph-default.webp">
    
  </head>

  <body>
    <div class="container">

      <input type="checkbox"
             id="mobile-menu-toggle"
             class="mobile-menu-toggle"
             aria-label="Toggle mobile menu">

      <div id="mobile-navbar" class="mobile-navbar">
        <div class="mobile-header-logo">
          <a href="https:&#x2F;&#x2F;klau.si"
             title="Klausi&#x27;s Weblog"
             rel="home"
             class="site-logo site-title">
            <img src="https://klau.si/logo.webp"
                 alt="Klausi&#x27;s Weblog logo">
          </a>
          <a href="/" class="logo">Klausi&#x27;s Weblog</a>
        </div>
        <label for="mobile-menu-toggle"
               class="mobile-navbar-icon"
               role="button"
               aria-controls="mobile-menu"
               aria-label="Toggle menu">
          <span aria-hidden="true">&nbsp;</span>
          <span aria-hidden="true">&nbsp;</span>
          <span aria-hidden="true">&nbsp;</span>
        </label>
      </div>

      <header id="header">
        <div class="logo">
          <a href="https:&#x2F;&#x2F;klau.si"
             title="Klausi&#x27;s Weblog"
             rel="home"
             class="site-logo site-title">
            <img src="https://klau.si/logo.webp"
                 alt="Klausi&#x27;s Weblog logo">
          </a>
          <a href="https:&#x2F;&#x2F;klau.si">Klausi&#x27;s Weblog</a>
        </div>
        <nav class="menu">
          <ul>
            
              <li>
                <a href="https:&#x2F;&#x2F;klau.si">
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;tags&#x2F;speaking">
                  Speaking
                  
                </a>
              </li>
            
              <li>
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;tags">
                  Categories
                  
                </a>
              </li>
            
              <li>
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;rss.xml">
                  RSS
                  

                    <img src="https://klau.si/icons/rss-icon.svg"
                         alt="RSS icon"
                         style="vertical-align: middle;
                                width: 16px;
                                height: 16px;
                                position: relative;
                                top: -2px">
                  
                </a>
              </li>
            
          </ul>
        </nav>
      </header>

      <main>
        <div class="content" id="mobile-panel">
          

            

            <div class="posts">
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;drupalcon-security-code-review&#x2F;">Drupalcon 2019 talk: Find security vulnerabilities through code review</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-11-03</span>
            
        </div>
    </header>

                  <div class="post__summary"><p>Here are <a rel="external" href="https://klausi.github.io/sec-code-review2019/#/">the slides</a> and the video of my DrupalCon Amsterdam 2019 talk "Find security vulnerabilities through code review".</p>
<div class="youtube-lazy" data-video-id="Oyoja2rfqSk">
  <a href="https://www.youtube.com/watch?v=Oyoja2rfqSk"
     class="youtube-lazy-placeholder"
     target="_blank"
     rel="noopener">
    <img src="https://klau.si/youtube-thumbs/Oyoja2rfqSk.webp"
         alt="YouTube video thumbnail - click to play"
         loading="lazy"
         width="480"
         height="270">
  </a>
</div></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;drupalcon-security-code-review&#x2F;">Read more...</a>
                  </div>
                </article>
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;a-new-blog-on-zola&#x2F;">A new blog on Zola</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-10-26</span>
            
        </div>
    </header>

                  <div class="post__summary"><p><img src="https://klau.si/blog/a-new-blog-on-zola/zola.ico" alt="Zola logo" /></p>
<p>I converted my old blog posts from Drupal to static files and now I'm trying out <a rel="external" href="https://www.getzola.org">Zola</a>. The static files are hosted on <a rel="external" href="https://www.getzola.org/documentation/deployment/github-pages/">Github Pages</a>.</p></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;a-new-blog-on-zola&#x2F;">Read more...</a>
                  </div>
                </article>
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;mocking-in-rust-with-conditional-compilation&#x2F;">Mocking in Rust with conditional compilation</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-03-31</span>
            
        </div>
    </header>

                  <div class="post__summary"><p>When writing automated unit tests for your application you will probably need to use <a rel="external" href="https://en.wikipedia.org/wiki/Mock_object">mocks</a> at some point. Classical object-oriented programming languages such as PHP solve this with reflection where mock object types are created during test runtime. The code under test expects a certain interface or class and the test code passes mock objects that implement the interface or are a subclass.</p>
<p>Similar approaches exist in Rust where mock objects are used to test code that expects a trait type. There is a wonderful <a rel="external" href="https://asomers.github.io/mock_shootout/">Rust mock framework comparison</a> by Alan Somers that lists their features. The biggest problem with most of them as far as I can see is that they cannot mock a foreign <code>struct</code> you are using in your code. Rust does not have a concept of object inheritance for structs so there is no way to mimic a struct type from the standard library or an external crate.</p></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;mocking-in-rust-with-conditional-compilation&#x2F;">Read more...</a>
                  </div>
                </article>
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;drupal-security-vulnerability-learnings&#x2F;">Drupal Austria Meetup: Drupal security learnings</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-03-13</span>
            
        </div>
    </header>

                  <div class="post__summary"><p><img src="https://klau.si/blog/drupal-security-vulnerability-learnings/meetup_security.jpeg" alt="Drupal Austria security meetup" /></p>
<p>Here are <a href="/presentations/sec-learnings2019/index.html">the slides</a> of my Drupal Austria Meetup talk "Drupal security learnings".</p></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;drupal-security-vulnerability-learnings&#x2F;">Read more...</a>
                  </div>
                </article>
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;benchmarking-a-rust-web-application&#x2F;">Benchmarking a Rust web application</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2018-08-31</span>
            
        </div>
    </header>

                  <div class="post__summary"><p>Performance testing is an important part when developing a network application - you want to know when you have a regression in request throughput in your service.</p>
<p>I set out out my goal 9 for Rustnish:</p>
<blockquote>
<p>Write benchmark code that compares runtime performance of Rustnish against
<a rel="external" href="https://varnish-cache.org/">Varnish</a>. Use <code>cargo bench</code> to execute the benchmarks.</p>
</blockquote>
<p>The basic idea of a performance test here is to send many HTTP requests to the web service (the reverse proxy in this case) and measure how fast the responses arrive back. Comparing the results from Rustnish and Varnish should give us an idea if our performance expectations are holding up.</p></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;benchmarking-a-rust-web-application&#x2F;">Read more...</a>
                  </div>
                </article>
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;crashing-a-rust-hyper-server-with-a-denial-of-service-attack&#x2F;">Crashing a Rust Hyper server with a Denial of Service attack</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2018-03-11</span>
            
        </div>
    </header>

                  <div class="post__summary"><p>I'm writing a reverse proxy in Rust using <a rel="external" href="https://hyper.rs/">Hyper</a> and I want
to measure performance a bit to know if I'm doing something terribly wrong. By
doing that I discovered a Denial of Service vulnerability in Hyper when IO
errors are not properly handled. Note that <a rel="external" href="https://github.com/hyperium/hyper/releases/tag/v0.11.20">a workaround has been released in
the meantime in Hyper
0.11.20</a>, more
background info can be found in <a rel="external" href="https://github.com/hyperium/hyper/issues/1358">this Hyper
issue</a>.</p></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;crashing-a-rust-hyper-server-with-a-denial-of-service-attack&#x2F;">Read more...</a>
                  </div>
                </article>
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;testing-memory-leaks-in-rust&#x2F;">Testing memory leaks in Rust</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2017-10-06</span>
            
        </div>
    </header>

                  <div class="post__summary"><p>Rust has many built-in concepts for memory safety, but it cannot prevent
application level logic errors that take up system memory. An example would be
a server application that stores something for each incoming request in a
growing collection or list. If the program does not clean up the growing list
then it will take up more and more server memory - thereby exposing a memory
leak.</p>
<p>While working on my reverse proxy project I discovered such a <a rel="external" href="https://github.com/hyperium/hyper/issues/1315">leak in the HTTP
library Hyper</a>. In order to
prevent and detect memory leaks in the future I set out my goal 7:</p>
<blockquote>
<p>Add an integration test that ensures that the proxy server is not leaking
memory (growing RAM usage without shrinking again). Use /proc information to
compare memory usage of the current process before and after the test.</p>
</blockquote></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;testing-memory-leaks-in-rust&#x2F;">Read more...</a>
                  </div>
                </article>
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;static-variables-made-thread-safe-in-rust&#x2F;">Static variables made thread-safe in Rust</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2017-09-09</span>
            
        </div>
    </header>

                  <div class="post__summary"><p>When writing <a href="https://klau.si/blog/writing-integration-tests-in-rust/">integration tests for my Rustnish reverse proxy project</a> I
have hard-coded port numbers in tests. This is not ideal because it is hard to
keep track of which port numbers have already been used and which ones are
available when writing a new test. Because Rust's test runner <a rel="external" href="https://doc.rust-lang.org/book/ch11-02-running-tests.html#running-tests-in-parallel-or-consecutively">executes test cases in parallel</a> it is important to coordinate
which test uses which ports so that there are no clashes that break the tests.</p>
<p>One obvious solution to this problem would be to disable parallel test
execution with <code>cargo test -- --test-threads=1</code>. But we want to cover program
and test isolation with our test so this is not really an option.</p></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;static-variables-made-thread-safe-in-rust&#x2F;">Read more...</a>
                  </div>
                </article>
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;replacing-unwrap-and-avoiding-panics-in-rust&#x2F;">Replacing unwrap() and avoiding panics in Rust</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2017-08-16</span>
            
        </div>
    </header>

                  <div class="post__summary"><p><a rel="external" href="https://doc.rust-lang.org/std/result/enum.Result.html#method.unwrap"><code>unwrap()</code></a> is a useful tool in Rust but is also bad practice in production code that
should not abort with unpredictable panics.</p>
<p>Therefore my goal 4 for Rustnish is full integration tests with no panics
allowed:</p>
<blockquote>
<p>Expand the integration tests to confirm that the reverse proxy is working as
expected. Add tests with broken HTTP requests to cover error handling of the
reverse proxy. All <code>unwrap()</code> calls in none test code should be removed
and covered by proper error handling.</p>
</blockquote></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;replacing-unwrap-and-avoiding-panics-in-rust&#x2F;">Read more...</a>
                  </div>
                </article>
              
                <article class="post">
                  
    <header class="post__header">
        <h1 class="post__title">
            
                <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;converting-a-hyper-server-to-tokio&#x2F;">Converting a Hyper server to Tokio</a>
            
        </h1>
        <div class="post__meta">
            <span class="post__time">2017-07-16</span>
            
        </div>
    </header>

                  <div class="post__summary"><p>Since my <a href="https://klau.si/blog/getting-started-with-rust/">first blog post where I constructed a server with Hyper</a> some time
has passed and there is now a new version of the library that is based on
<a rel="external" href="https://tokio.rs">Tokio</a>. My goal 3:</p>
<blockquote>
<p>A new version of the Hyper library has been released which is
based on the Tokio library. Convert the existing code to use that new version
and provide one integration test case.</p>
</blockquote>
<p>Tokio handles input/output asynchronously, which makes setting up a server more
complicated. The benefit is more efficient parallel execution with a
non-blocking event loop.</p></div>
                  <div class="read-more">
                    <a href="https:&#x2F;&#x2F;klau.si&#x2F;blog&#x2F;converting-a-hyper-server-to-tokio&#x2F;">Read more...</a>
                  </div>
                </article>
              
            </div>
            <nav class="pagination">
              <a class="previous" href="https:&#x2F;&#x2F;klau.si&#x2F;">‹ Previous</a>
              <a class="next" href="https:&#x2F;&#x2F;klau.si&#x2F;page&#x2F;3&#x2F;">Next ›</a>
            </nav>
          
        </div>
      </main>

      
        <footer>
          <ul class="footer-social">
            <li>
              <a href="https://mastodon.social/@klausi" title="Mastodon" rel="me">
                <img src="https://klau.si/icons/mastodon.svg"
                     alt="Mastodon icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>Human social media</span>
              </a>
            </li>
            <li>
              <a href="https://www.drupal.org/u/klausi" title="Drupal" rel="me">
                <img src="https://klau.si/icons/drupal.svg"
                     alt="Drupal icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>Drupal profile</span>
              </a>
            </li>
            <li>
              <a href="https://github.com/klausi" title="GitHub" rel="me">
                <picture>
                  <source media="(prefers-color-scheme: dark)"
                          srcset="https://klau.si/icons/github-darkmode.svg">
                  <img src="https://klau.si/icons/github.svg"
                       alt="GitHub icon"
                       class="social-icon"
                       width="24"
                       height="24">
                </picture>
                <span>Stalk my code</span>
              </a>
            </li>
            <li>
              <a href="https://bsky.app/profile/klau.si" title="Bluesky" rel="me">
                <img src="https://klau.si/icons/bluesky.svg"
                     alt="Bluesky icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>Fake Twitter funded by crypto bros</span>
              </a>
            </li>
            <li>
              <a href="https://www.linkedin.com/in/klausi" title="LinkedIn" rel="me">
                <img src="https://klau.si/icons/linkedin.svg"
                     alt="LinkedIn icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>The business hellsite</span>
              </a>
            </li>
            <li>
              <a href="https://klau.si/rss.xml"
                 title="RSS Feed">
                <img src="https://klau.si/icons/rss-icon.svg"
                     alt="RSS icon"
                     class="social-icon"
                     width="24"
                     height="24">
                <span>RSS</span>
              </a>
            </li>
          </ul>
          <p class="footer-license">
            <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
              <img alt="Creative Commons License"
                   style="border-width:0"
                   src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
            </a>
            <br />
            This work by
            <span xmlns:cc="http://creativecommons.org/ns#"
                  property="cc:attributionName">Klaus Purer</span> is licensed
            under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons
            Attribution-ShareAlike 4.0 International License</a>.
          </p>
        </footer>
      

      <nav id="mobile-menu" class="mobile-menu">
        <ul class="mobile-menu-list">
          
            <li class="mobile-menu-item">
              <a href="https:&#x2F;&#x2F;klau.si">
                Home
                
              </a>
            </li>
          
            <li class="mobile-menu-item">
              <a href="https:&#x2F;&#x2F;klau.si&#x2F;tags&#x2F;speaking">
                Speaking
                
              </a>
            </li>
          
            <li class="mobile-menu-item">
              <a href="https:&#x2F;&#x2F;klau.si&#x2F;tags">
                Categories
                
              </a>
            </li>
          
            <li class="mobile-menu-item">
              <a href="https:&#x2F;&#x2F;klau.si&#x2F;rss.xml">
                RSS
                

                  <img src="https://klau.si/icons/rss-icon.svg"
                       alt="RSS icon"
                       style="vertical-align: middle;
                              width: 16px;
                              height: 16px;
                              position: relative;
                              top: -2px">
                
              </a>
            </li>
          
        </ul>
      </nav>

      <label for="mobile-menu-toggle"
             class="mobile-menu-overlay"
             aria-hidden="true">&nbsp;</label>
    </div>

    
      <script type="text/javascript"
              src="https://klau.si/even.js"></script>
    
  </body>

</html>
